<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ–°æ–‡ç§‘ å›¾ç‰‡ä¿®æ”¹å™¨</title>
    <style>
        :root {
            --accent: #4f6df0;
            --accent-hover: #3d5fde;
            --text-color: #1f2937;
            --text-light: #6b7280;
            --text-muted: #9ca3af;
            --background: #f7f9fc;
            --surface: #eef2f7;
            --glass-bg: rgba(255, 255, 255, 0.7);
            --glass-border: rgba(15, 23, 42, 0.08);
            --error: #ef4444;
            --success: #10b981;
            --info: #3b82f6;
            --shadow-sm: 0 1px 3px rgba(0, 0, 0, 0.08);
            --shadow-md: 0 8px 16px rgba(0, 0, 0, 0.10);
            --shadow-lg: 0 16px 24px rgba(0, 0, 0, 0.12);
            --radius-sm: 0.375rem;
            --radius-md: 0.75rem;
            --radius-lg: 1rem;
            --radius-xl: 1.25rem;
            --transition: all 0.22s ease;
            /* èƒŒæ™¯å…‰æ™•å˜é‡ */
            --bg-glow-1: rgba(79, 109, 240, 0.10);
            --bg-glow-2: rgba(79, 109, 240, 0.08);
            /* ç§‘æŠ€æ„Ÿæ¸å˜è‰² */
            --accent-cyan: #22d3ee;
            --accent-purple: #a855f7;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
            background:
                radial-gradient(900px circle at -12% -12%, var(--bg-glow-1), transparent 65%),
                radial-gradient(750px circle at 112% 122%, var(--bg-glow-2), transparent 60%),
                linear-gradient(180deg, var(--background) 0%, var(--surface) 100%);
            color: var(--text-color);
            line-height: 1.6;
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 28px;
        }

        .container {
            max-width: 1100px;
            width: 100%;
            background: var(--glass-bg);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid var(--glass-border);
            border-radius: var(--radius-xl);
            box-shadow: var(--shadow-lg), 0 0 0 1px rgba(79, 109, 240, 0.25), 0 0 24px rgba(79, 109, 240, 0.12), 0 0 36px rgba(34, 211, 238, 0.10);
            overflow: hidden;
            transition: var(--transition);
            position: relative;
            z-index: 1;
        }

        #bg-canvas {
            position: fixed;
            inset: 0;
            z-index: 0;
            pointer-events: none;
        }

        #glass-overlay {
            position: fixed;
            inset: 0;
            z-index: 0;
            pointer-events: none;
            /* ç§‘æŠ€æ„Ÿç½‘æ ¼å åŠ  */
            background-image:
                repeating-linear-gradient(0deg, rgba(31,41,55,0.05) 0px, rgba(31,41,55,0.05) 1px, transparent 1px, transparent 24px),
                repeating-linear-gradient(90deg, rgba(31,41,55,0.04) 0px, rgba(31,41,55,0.04) 1px, transparent 1px, transparent 24px);
        }
        #glass-overlay::before,
        #glass-overlay::after {
            content: '';
            position: absolute;
            width: 540px;
            height: 540px;
            border-radius: 50%;
            filter: blur(32px) saturate(120%);
            opacity: 0.35;
        }
        #glass-overlay::before {
            top: -80px;
            left: -90px;
            background: radial-gradient(60% 60% at 35% 35%, rgba(79, 109, 240, 0.22) 0%, rgba(79, 109, 240, 0.10) 40%, rgba(255, 255, 255, 0.06) 70%, transparent 100%);
        }
        #glass-overlay::after {
            bottom: -120px;
            right: -100px;
            background: radial-gradient(60% 60% at 65% 65%, rgba(16, 185, 129, 0.18) 0%, rgba(16, 185, 129, 0.08) 40%, rgba(255, 255, 255, 0.05) 70%, transparent 100%);
        }

        header {
            background: var(--glass-bg);
            border-bottom: 1px solid var(--glass-border);
            color: var(--text-color);
            padding: 1.75rem 2rem 1.25rem;
            text-align: center;
        }

        h1 {
            font-size: 2.25rem;
            font-weight: 700;
            margin-bottom: 0.375rem;
            letter-spacing: -0.02em;
        }

        header p {
            color: var(--text-muted);
            font-size: 0.95rem;
        }

        main {
            padding: 2rem;
        }

        .tabs {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1.5rem;
        }

        .tab {
            flex: none;
            padding: 0.65rem 1rem;
            text-align: center;
            cursor: pointer;
            transition: var(--transition);
            font-weight: 500;
            font-size: 0.98rem;
            color: var(--text-light);
            background: var(--glass-bg);
            border: 1px solid var(--glass-border);
            border-radius: 999px;
        }

        .tab:hover {
            color: var(--text-color);
        }

        .tab.active {
            color: var(--text-color);
            background: linear-gradient(90deg, rgba(79,109,240,0.12), rgba(34,211,238,0.10));
            border-color: var(--accent);
            box-shadow: 0 0 0 1px rgba(79,109,240,0.35), 0 0 14px rgba(79,109,240,0.18);
        }

        .tab-content {
            display: none;
            animation: fadeIn 0.2s ease-in-out;
        }

        .tab-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(6px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .form-group {
            margin-bottom: 1.1rem;
        }

        label {
            display: block;
            font-weight: 600;
            color: var(--text-color);
            margin-bottom: 0.45rem;
            font-size: 0.9rem;
            letter-spacing: 0.01em;
        }

        input, textarea, select {
            width: 100%;
            padding: 0.85rem 1rem;
            border: 1px solid var(--glass-border);
            border-radius: var(--radius-md);
            font-size: 1.05rem;
            transition: var(--transition);
            background: rgba(255, 255, 255, 0.85);
            color: var(--text-color);
            font-family: inherit;
        }

        input::placeholder,
        textarea::placeholder {
            color: var(--text-light);
        }

        input:focus,
        textarea:focus,
        select:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 3px rgba(79, 109, 240, 0.12);
            background: #ffffff;
        }

        textarea {
            resize: vertical;
            min-height: 110px;
            line-height: 1.6;
        }

        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        input[type="checkbox"] {
            width: 1rem;
            height: 1rem;
            cursor: pointer;
        }

        button {
            background: linear-gradient(90deg, var(--accent), var(--accent-cyan));
            color: white;
            border: none;
            padding: 0.9rem 1.2rem;
            border-radius: var(--radius-md);
            font-size: 1.06rem;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            width: 100%;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            position: relative;
            overflow: hidden;
            box-shadow: 0 0 0 1px rgba(79,109,240,0.35), 0 10px 20px rgba(79,109,240,0.18);
        }

        button:hover {
            background: linear-gradient(90deg, var(--accent-hover), var(--accent-cyan));
            transform: translateY(-1px);
            box-shadow: 0 0 0 1px rgba(79,109,240,0.45), 0 14px 26px rgba(79,109,240,0.22);
        }
        /* é¼ æ ‡è·Ÿè¸ªé«˜å…‰ */
        button::before {
            content: "";
            position: absolute;
            inset: 0;
            pointer-events: none;
            background: radial-gradient(180px circle at var(--mouse-x) var(--mouse-y), rgba(34,211,238,0.28), rgba(168,85,247,0.18) 30%, transparent 60%);
            opacity: var(--glow-alpha, 0);
            transition: opacity 0.18s ease;
            filter: blur(10px);
            mix-blend-mode: screen;
        }
        /* ç‚¹å‡»æ¶Ÿæ¼ª */
         .ripple {
             position: absolute;
             width: 12px;
             height: 12px;
             border-radius: 50%;
             pointer-events: none;
             background: radial-gradient(closest-side, rgba(255,255,255,0.8), rgba(79,109,240,0.5) 60%, transparent 100%);
             transform: scale(0);
             opacity: 0.85;
             animation: ripple 650ms ease-out forwards;
         }
         @keyframes ripple {
             to {
                 transform: scale(22);
                 opacity: 0;
             }
         }
         /* èƒŒæ™¯æ¿æ¶Ÿæ¼ªï¼ˆæ›´å¤§ã€æ›´æŸ”ï¼‰ */
         .ripple-bg {
             position: absolute;
             width: 16px;
             height: 16px;
             border-radius: 50%;
             pointer-events: none;
             background: radial-gradient(closest-side, rgba(255,255,255,0.55), rgba(79,109,240,0.35) 60%, transparent 100%);
             transform: scale(0);
             opacity: 0.40;
             animation: ripple-bg 900ms ease-out forwards;
         }
         @keyframes ripple-bg {
             to {
                 transform: scale(60);
                 opacity: 0;
             }
         }

        button:active {
            background: var(--accent);
        }

        .result {
            margin-top: 1.1rem;
            border-radius: var(--radius-md);
            overflow: hidden;
            transition: var(--transition);
        }

        .message {
            padding: 0.85rem;
            border-radius: var(--radius-md);
            margin-bottom: 0.85rem;
            font-size: 0.9rem;
            text-align: center;
            border: 1px solid var(--glass-border);
            background: var(--glass-bg);
        }

        .message.info {
            color: var(--info);
        }

        .message.error {
            color: var(--error);
        }

        .message.success {
            color: var(--success);
        }

        .image-container {
            margin-top: 0.7rem;
            border-radius: var(--radius-md);
            overflow: hidden;
            transition: var(--transition);
            background: #ffffff;
            padding: 0.7rem;
            border: 1px solid var(--glass-border);
        }

        .image-container img {
            max-width: 100%;
            height: auto;
            border-radius: var(--radius-sm);
            display: block;
            margin: 0 auto;
        }

        /* Upload area and thumbs */
        .upload-area {
            border: 2px dashed var(--glass-border);
            background: var(--glass-bg);
            border-radius: var(--radius-lg);
            padding: 1.2rem;
            text-align: center;
            color: var(--text-light);
        }

        .upload-icon {
            font-size: 1.5rem;
        }

        .upload-text {
            margin-top: 0.25rem;
            font-weight: 600;
            color: var(--text-color);
        }

        .upload-hint {
            margin-top: 0.25rem;
            font-size: 0.85rem;
            color: var(--text-muted);
        }

        .thumb-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-top: 0.6rem;
        }

        .thumb-item {
            background: var(--glass-bg);
            border: 1px solid var(--glass-border);
            border-radius: var(--radius-md);
            padding: 8px;
        }

        .thumb-item img {
            width: 100%;
            height: 110px;
            object-fit: cover;
            border-radius: var(--radius-sm);
        }

        .thumb-name {
            display: block;
            margin-top: 6px;
            font-size: 0.8rem;
            color: var(--text-light);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        /* Loading spinner */
        .loading {
            display: inline-block;
            width: 1.05rem;
            height: 1.05rem;
            border: 2px solid rgba(255, 255, 255, 0.6);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        @media (max-width: 768px) {
            body {
                padding: 16px;
                background:
                    radial-gradient(650px circle at -20% -20%, var(--bg-glow-1), transparent 68%),
                    radial-gradient(520px circle at 115% 120%, var(--bg-glow-2), transparent 62%),
                    linear-gradient(180deg, var(--background) 0%, var(--surface) 100%);
            }

            .container {
                border-radius: var(--radius-lg);
            }

            header {
                padding: 1.4rem;
            }

            h1 {
                font-size: 1.6rem;
            }

            main {
                padding: 1.1rem;
            }

            .thumb-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }
    </style>
    <!-- Google Fonts - Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>

<body>
     <canvas id="bg-canvas" aria-hidden="true"></canvas>
     <div id="glass-overlay" aria-hidden="true"></div>
     <div class="container">
        <header>
            <h1>æ–°æ–‡ç§‘ å›¾ç‰‡ä¿®æ”¹å™¨</h1>
            <p>é€šè¿‡ AI æŠ€æœ¯å°†æ–‡å­—æè¿°è½¬æ¢ä¸ºç²¾ç¾å›¾åƒ</p>
        </header>

        <main>
            <div class="tabs">
                <div class="tab active" onclick="switchTab('text-to-image')">æ–‡ç”Ÿå›¾</div>
                <div class="tab" onclick="switchTab('image-to-image')">å›¾æ–‡ç”Ÿå›¾</div>
                <div class="tab" onclick="switchTab('bulk-select')">æ‰¹é‡ä¼˜é€‰</div>
            </div>

            <!-- æ–‡ç”Ÿå›¾è¡¨å• -->
            <div id="text-to-image" class="tab-content active">
                <div class="form-group">
                    <label for="text-prompt">å›¾ç‰‡æè¿°</label>
                    <textarea id="text-prompt" placeholder="è¯·è¾“å…¥è¯¦ç»†çš„å›¾ç‰‡æè¿°..."></textarea>
                </div>
                <div class="form-group">
                    <label for="text-size">å›¾ç‰‡å°ºå¯¸</label>
                    <select id="text-size">
                        <option value="2K">2K (2560Ã—1440)</option>
                    </select>
                </div>
                <div class="form-group">
                    <div class="checkbox-group">
                        <input type="checkbox" id="text-watermark" checked>
                        <label for="text-watermark">æ·»åŠ æ°´å°</label>
                    </div>
                </div>
                <button id="text-button" onclick="generateTextToImage()">
                    <span>ç”Ÿæˆå›¾ç‰‡</span>
                </button>

                <div id="text-result" class="result"></div>
            </div>

            <!-- å›¾æ–‡ç”Ÿå›¾è¡¨å• -->
            <div id="image-to-image" class="tab-content">
                <div class="form-group">
                    <label for="image-prompt">å›¾ç‰‡æè¿°</label>
                    <textarea id="image-prompt" placeholder="è¯·è¾“å…¥è¯¦ç»†çš„å›¾ç‰‡æè¿°..."></textarea>
                </div>
                <div class="form-group">
                    <label for="reference-image">å‚è€ƒå›¾ç‰‡URL</label>
                    <input type="text" id="reference-image" placeholder="https://example.com/image.jpg">
                </div>
                <div class="form-group">
                    <label for="image-size">å›¾ç‰‡å°ºå¯¸</label>
                    <select id="image-size">
                        <option value="2K">2K (2560Ã—1440)</option>
                    </select>
                </div>
                <div class="form-group">
                    <div class="checkbox-group">
                        <input type="checkbox" id="image-watermark" checked>
                        <label for="image-watermark">æ·»åŠ æ°´å°</label>
                    </div>
                </div>
                <button id="image-button" onclick="generateImageToImage()">
                    <span>ç”Ÿæˆå›¾ç‰‡</span>
                </button>

                <div id="image-result" class="result"></div>
            </div>

            <!-- æ‰¹é‡ä¼˜é€‰ -->
            <div id="bulk-select" class="tab-content">
                <div class="form-group">
                    <label for="bulk-images">ä¸Šä¼ å›¾ç‰‡ï¼ˆå¯å¤šé€‰ï¼‰</label>
                    <div class="upload-area" onclick="document.getElementById('bulk-images').click()">
                        <div class="upload-icon">ğŸ“</div>
                        <div class="upload-text">ç‚¹å‡»é€‰æ‹©æˆ–æ‹–æ‹½å›¾ç‰‡åˆ°æ­¤å¤„</div>
                        <div class="upload-hint">æœ€å¤šé€‰æ‹© 20 å¼ ï¼Œæ”¯æŒ JPG/PNG/WebP</div>
                    </div>
                    <input type="file" id="bulk-images" accept="image/*" multiple style="display:none"
                        onchange="updateBulkPreview()">
                </div>
                <div id="bulk-preview" class="thumb-grid"></div>
                <button id="bulk-button" onclick="generateBestImageSelection()">
                    <span>å¼€å§‹ä¼˜é€‰</span>
                </button>
                <div id="bulk-result" class="result"></div>
            </div>

        </main>
    </div>

    <script>
        // åŠ¨æ€åƒç´ èƒŒæ™¯ï¼ˆCanvasï¼‰
        (function () {
            const canvas = document.getElementById('bg-canvas');
            if (!canvas) return;
            const ctx = canvas.getContext('2d');
            let dpi = window.devicePixelRatio || 1;

            let mouse = { x: -9999, y: -9999 };
            let width = 0, height = 0, cols = 0, rows = 0;
            const cell = 30; // åƒç´ æ–¹æ ¼å¤§å°
            const radius = 50; // å½±å“åŠå¾„ï¼ˆæ›´å°èŒƒå›´ï¼‰
            const baseAlpha = 0.04; // åŸºç¡€é€æ˜åº¦
            const maxAlpha = 0.5; // é¼ æ ‡é™„è¿‘å¢å¼ºé€æ˜åº¦ï¼ˆæ›´äº®ï¼‰
            const accent = getComputedStyle(document.documentElement).getPropertyValue('--accent').trim() || '#4f6df0';
            const neutralPrefix = 'rgba(31,41,55,'; // æ·±ç°è½»ç‚¹
            let field = [];
            let ripples = [];

            function resize() {
                width = window.innerWidth;
                height = window.innerHeight;
                canvas.style.width = width + 'px';
                canvas.style.height = height + 'px';
                canvas.width = Math.floor(width * dpi);
                canvas.height = Math.floor(height * dpi);
                cols = Math.ceil(width / cell);
                rows = Math.ceil(height / cell);
                field = new Array(cols * rows).fill(baseAlpha);
                draw(true);
            }

            function lerp(a, b, t) { return a + (b - a) * t; }

            function toRGBA(hex, alpha) {
                // ç®€å•hexè½¬rgbaï¼Œä»…æ”¯æŒ #rrggbb
                const m = hex.match(/^#([0-9a-fA-F]{6})$/);
                if (!m) return `rgba(79,109,240,${alpha})`;
                const int = parseInt(m[1], 16);
                const r = (int >> 16) & 255;
                const g = (int >> 8) & 255;
                const b = int & 255;
                return `rgba(${r},${g},${b},${alpha})`;
            }

            function draw(initial) {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                ctx.save();
                ctx.scale(dpi, dpi);

                const now = performance.now();
                for (let r = 0; r < rows; r++) {
                    for (let c = 0; c < cols; c++) {
                        const x = c * cell;
                        const y = r * cell;
                        const cx = x + cell / 2;
                        const cy = y + cell / 2;
                        const dx = cx - mouse.x;
                        const dy = cy - mouse.y;
                        const dist = Math.sqrt(dx * dx + dy * dy);
                        const t = Math.max(0, 1 - dist / radius);

                        // è”åŠ¨æ¶Ÿæ¼ªï¼šè®¡ç®—å½“å‰åƒç´ æ ¼å—åˆ°çš„ç¯å½¢å½±å“
                        let rippleInfluence = 0;
                        for (let i = 0; i < ripples.length; i++) {
                            const rp = ripples[i];
                            const tr = Math.min((now - rp.start) / rp.duration, 1);
                            if (tr <= 0 || tr >= 1) continue;
                            const rr = rp.maxRadius * tr;
                            const drx = cx - rp.x;
                            const dry = cy - rp.y;
                            const dr = Math.sqrt(drx * drx + dry * dry);
                            const ringWidth = 80; // æ³¢çº¹åšåº¦
                            const delta = Math.abs(dr - rr);
                            const ringFactor = Math.max(0, 1 - delta / ringWidth);
                            rippleInfluence = Math.max(rippleInfluence, ringFactor * rp.alpha);
                        }

                        const mouseTerm = t * (maxAlpha - baseAlpha);
                        const rippleTerm = rippleInfluence * (maxAlpha - baseAlpha) * 0.8;
                        const target = Math.min(maxAlpha, baseAlpha + mouseTerm + rippleTerm);
                        const idx = r * cols + c;
                        const prev = field[idx];
                        const next = initial ? target : lerp(prev, target, 0.18);
                        field[idx] = next;

                        const accentTrigger = Math.max(t, rippleInfluence * 0.9);
                        const fill = accentTrigger > 0.15 ? toRGBA(accent, next) : (neutralPrefix + next + ')');
                        ctx.fillStyle = fill;
                        ctx.fillRect(x, y, cell - 1, cell - 1);
                    }
                }
                // æ¶Ÿæ¼ªä¸åƒç´ æ ¼å·²è”åŠ¨ï¼Œå–æ¶ˆå åŠ ç»˜åˆ¶
                ctx.restore();
                requestAnimationFrame(step);
            }

            function step() { draw(false); }

            window.addEventListener('mousemove', (e) => { mouse.x = e.clientX; mouse.y = e.clientY; }, { passive: true });
            window.addEventListener('mouseleave', () => { mouse.x = -9999; mouse.y = -9999; });

            const prefersReduced = window.matchMedia('(prefers-reduced-motion: reduce)').matches;
            const isMobile = /Android|iPhone|iPad|iPod/i.test(navigator.userAgent);
            if (prefersReduced || isMobile) {
                const el = document.getElementById('bg-canvas');
                if (el) el.style.display = 'none';
            } else {
                window.addEventListener('resize', resize);
                resize();
                // èƒŒæ™¯åƒç´ æ¿ç‚¹å‡»æ¶Ÿæ¼ªï¼Œä»…åœ¨éæ§ä»¶åŒºåŸŸè§¦å‘
                window.addEventListener('mousedown', (e) => {
                    if (prefersReduced || isMobile) return;
                    if (e.target && e.target.closest('.container, button, a, input, textarea, select, label, .tab')) return;
                    ripples.push({
                        x: e.clientX,
                        y: e.clientY,
                        start: performance.now(),
                        duration: 900,
                        maxRadius: Math.max(width, height) * 0.45,
                        alpha: 0.35
                    });
                }, { passive: true });
            }
        })();
    </script>

    <script>
        function switchTab(tabName) {
            // éšè—æ‰€æœ‰æ ‡ç­¾å†…å®¹
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });

            // ç§»é™¤æ‰€æœ‰æ ‡ç­¾çš„æ´»åŠ¨çŠ¶æ€
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });

            // æ˜¾ç¤ºé€‰ä¸­çš„æ ‡ç­¾å†…å®¹
            document.getElementById(tabName).classList.add('active');

            // è®¾ç½®é€‰ä¸­æ ‡ç­¾ä¸ºæ´»åŠ¨çŠ¶æ€
            event.currentTarget.classList.add('active');
        }

        function generateTextToImage() {
            const prompt = document.getElementById('text-prompt').value;
            const size = document.getElementById('text-size').value;
            const watermark = document.getElementById('text-watermark').checked;
            const button = document.getElementById('text-button');
            const originalButtonText = button.innerHTML;

            if (!prompt) {
                showResult('text-result', 'è¯·è¾“å…¥å›¾ç‰‡æè¿°', 'error');
                return;
            }

            // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
            button.disabled = true;
            button.innerHTML = '<div class="loading"></div> <span>ç”Ÿæˆä¸­...</span>';

            showResult('text-result', 'æ­£åœ¨ç”Ÿæˆå›¾ç‰‡ï¼Œè¯·ç¨å€™...', 'info');

            fetch('/api/generate/text-to-image', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    prompt: prompt,
                    size: size,
                    watermark: watermark
                })
            })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        showImageResult('text-result', data.image_url);
                    } else {
                        showResult('text-result', data.error || 'ç”Ÿæˆå¤±è´¥', 'error');
                    }
                })
                .catch(error => {
                    showResult('text-result', 'è¯·æ±‚å¤±è´¥: ' + error.message, 'error');
                })
                .finally(() => {
                    // æ¢å¤æŒ‰é’®çŠ¶æ€
                    button.disabled = false;
                    button.innerHTML = originalButtonText;
                });
        }

        function generateImageToImage() {
            const prompt = document.getElementById('image-prompt').value;
            const imageUrl = document.getElementById('reference-image').value;
            const size = document.getElementById('image-size').value;
            const watermark = document.getElementById('image-watermark').checked;
            const button = document.getElementById('image-button');
            const originalButtonText = button.innerHTML;

            if (!prompt) {
                showResult('image-result', 'è¯·è¾“å…¥å›¾ç‰‡æè¿°', 'error');
                return;
            }

            if (!imageUrl) {
                showResult('image-result', 'è¯·è¾“å…¥å‚è€ƒå›¾ç‰‡URL', 'error');
                return;
            }

            // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
            button.disabled = true;
            button.innerHTML = '<div class="loading"></div> <span>ç”Ÿæˆä¸­...</span>';

            showResult('image-result', 'æ­£åœ¨ç”Ÿæˆå›¾ç‰‡ï¼Œè¯·ç¨å€™...', 'info');

            fetch('/api/generate/image-to-image', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    prompt: prompt,
                    image_url: imageUrl,
                    size: size,
                    watermark: watermark
                })
            })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        showImageResult('image-result', data.image_url);
                    } else {
                        showResult('image-result', data.error || 'ç”Ÿæˆå¤±è´¥', 'error');
                    }
                })
                .catch(error => {
                    showResult('image-result', 'è¯·æ±‚å¤±è´¥: ' + error.message, 'error');
                })
                .finally(() => {
                    // æ¢å¤æŒ‰é’®çŠ¶æ€
                    button.disabled = false;
                    button.innerHTML = originalButtonText;
                });
        }

        function showResult(elementId, message, type) {
            const resultElement = document.getElementById(elementId);
            resultElement.innerHTML = `<div class="message ${type}">${message}</div>`;
        }

        function showImageResult(elementId, imageUrl) {
            const resultElement = document.getElementById(elementId);
            resultElement.innerHTML = `
                <div class="message success">å›¾ç‰‡ç”ŸæˆæˆåŠŸï¼</div>
                <div class="image-container">
                    <img src="${imageUrl}" alt="ç”Ÿæˆçš„å›¾ç‰‡">
                </div>
            `;
        }

        function generateBestImageSelection() {
            const input = document.getElementById('bulk-images');
            const files = Array.from(input.files);
            const button = document.getElementById('bulk-button');
            const originalButtonText = button.innerHTML;

            if (!files.length) {
                showResult('bulk-result', 'è¯·è‡³å°‘é€‰æ‹©ä¸€å¼ å›¾ç‰‡', 'error');
                return;
            }

            button.disabled = true;
            button.innerHTML = '<div class="loading"></div> <span>ä¼˜é€‰ä¸­...</span>';
            showResult('bulk-result', 'æ­£åœ¨è¯„ä¼°å›¾ç‰‡è´¨é‡ï¼Œè¯·ç¨å€™...', 'info');

            const formData = new FormData();
            files.forEach(file => formData.append('images', file));

            fetch('/api/select/best-image', {
                method: 'POST',
                body: formData
            })
                .then(res => res.json())
                .then(data => {
                    if (data.success) {
                        const imgSrc = `data:image/${data.format || 'jpeg'};base64,${data.best_image_b64}`;
                        const resultElement = document.getElementById('bulk-result');
                        const scoreList = (data.scores || []).map((s, i) => `<li>å›¾ç‰‡ ${i + 1}: ${Number(s).toFixed(3)}</li>`).join('');
                        resultElement.innerHTML = `
                            <div class="message success">ä¼˜é€‰å®Œæˆï¼Œæœ€ä½³å›¾ç‰‡ä¸ºç¬¬ ${data.best_index + 1} å¼ </div>
                            <div class="image-container">
                                <img src="${imgSrc}" alt="æœ€ä½³å›¾ç‰‡">
                            </div>
                            <div class="message info" style="margin-top:0.75rem;">
                                è¯„åˆ†åˆ—è¡¨ï¼š
                                <ul style="margin-top:0.5rem; text-align:left; padding-left:1.25rem;">
                                    ${scoreList}
                                </ul>
                            </div>
                        `;
                    } else {
                        showResult('bulk-result', data.error || 'ä¼˜é€‰å¤±è´¥', 'error');
                    }
                })
                .catch(err => {
                    showResult('bulk-result', 'è¯·æ±‚å¤±è´¥: ' + err.message, 'error');
                })
                .finally(() => {
                    button.disabled = false;
                    button.innerHTML = originalButtonText;
                });
        }

        function updateBulkPreview() {
            const input = document.getElementById('bulk-images');
            const files = Array.from(input.files);
            const preview = document.getElementById('bulk-preview');
            if (!files.length) { preview.innerHTML = ''; return; }
            const max = Math.min(files.length, 12);
            preview.innerHTML = '';
            for (let i = 0; i < max; i++) {
                const file = files[i];
                const reader = new FileReader();
                reader.onload = e => {
                    const div = document.createElement('div');
                    div.className = 'thumb-item';
                    div.innerHTML = `
                        <img src="${e.target.result}" alt="${file.name}">
                        <span class="thumb-name">${file.name}</span>
                    `;
                    preview.appendChild(div);
                };
                reader.readAsDataURL(file);
            }
        }
    </script>
<script>
      (function(){
        const prefersReduced = window.matchMedia('(prefers-reduced-motion: reduce)').matches;
        const buttons = document.querySelectorAll('button');
        buttons.forEach(btn => {
           const onMove = (e) => {
             const rect = btn.getBoundingClientRect();
             const x = e.clientX - rect.left;
             const y = e.clientY - rect.top;
             btn.style.setProperty('--mouse-x', x + 'px');
             btn.style.setProperty('--mouse-y', y + 'px');
             btn.style.setProperty('--glow-alpha', '1');
           };
           btn.addEventListener('mousemove', onMove);
           btn.addEventListener('mouseleave', () => {
             btn.style.setProperty('--glow-alpha', '0');
           });
           btn.addEventListener('mousedown', (e) => {
             if (prefersReduced) return;
             const rect = btn.getBoundingClientRect();
             const x = e.clientX - rect.left;
             const y = e.clientY - rect.top;
             const ripple = document.createElement('span');
             ripple.className = 'ripple';
             ripple.style.left = (x - 6) + 'px';
             ripple.style.top = (y - 6) + 'px';
             btn.appendChild(ripple);
             ripple.addEventListener('animationend', () => ripple.remove());
           });
         });

         // èƒŒæ™¯æ¿ï¼ˆå®¹å™¨ï¼‰ç‚¹å‡»æ¶Ÿæ¼ª
         const container = document.querySelector('.container');
         if (container) {
           container.addEventListener('mousedown', (e) => {
             if (prefersReduced) return;
             // é¿å…ä¸æŒ‰é’®/è¾“å…¥/æ ‡ç­¾ç­‰äº¤äº’é‡å¤æ¶Ÿæ¼ª
             if (e.target && e.target.closest('button, a, input, textarea, select, label, .tab')) return;
             const rect = container.getBoundingClientRect();
             const x = e.clientX - rect.left;
             const y = e.clientY - rect.top;
             const ripple = document.createElement('span');
             ripple.className = 'ripple ripple-bg';
             ripple.style.left = (x - 8) + 'px';
             ripple.style.top = (y - 8) + 'px';
             container.appendChild(ripple);
             ripple.addEventListener('animationend', () => ripple.remove());
           });
         }
       })();
     </script>
    </body>

</html>